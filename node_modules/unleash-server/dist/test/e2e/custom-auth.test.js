"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const database_init_1 = __importDefault(require("./helpers/database-init"));
const test_helper_1 = require("./helpers/test-helper");
let db;
let stores;
beforeAll(async () => {
    db = await database_init_1.default('custom_auth_serial');
    stores = db.stores;
});
test('Using custom auth type without defining custom middleware causes default DENY ALL policy to take effect', async () => {
    expect.assertions(1);
    const { request, destroy } = await test_helper_1.setupAppWithCustomAuth(stores, undefined);
    await request
        .get('/api/admin/features')
        .expect(401)
        .expect(res => {
        expect(res.body.error).toBe('You have to configure a custom authentication middleware. Read https://docs.getunleash.io/docs/deploy/configuring_unleash for more details');
    });
    await destroy();
});
test('If actually configuring a custom middleware should configure the middleware', async () => {
    expect.assertions(0);
    const { request, destroy } = await test_helper_1.setupAppWithCustomAuth(stores, () => { });
    await request.get('/api/admin/features').expect(200);
    await destroy();
});
//# sourceMappingURL=custom-auth.test.js.map